(function($){$(function(){var f=wpps_results_vars.legacy_api_url;var g=wpps_results_vars.permalink_structure;var h={apps:{},models:{},collections:{},views:{}};function validatePSThemeContainer(a,b){var c=false;if(a.children().length===0){if(a.hasClass(b)){c=true}}else{a.children().each(function(){c=validatePSThemeContainer($(this),b);if(c){return false}})}return c};function addClassToEndChildren(a,b){if(a.children().length===0){if(!a.hasClass('no-add')){a.addClass(b)}}else{a.children().each(function(){addClassToEndChildren($(this),b)})}};_.templateSettings={evaluate:/[<{][%{](.+?)[%}][}>]/g,interpolate:/[<{][%{]=(.+?)[%}][}>]/g,escape:/[<{][%{]-(.+?)[%}][}>]/g}h.models.Item=Backbone.Model.extend({defaults:{title:'Empty Post',url:null,image_url:null,description:null,categories:[],tags:[],type:'post',status:true,card:'',...wpps_results_vars.item_extra_data}});h.collections.Items=Backbone.Collection.extend({model:h.models.Item});h.views.Item=Backbone.View.extend({tagName:'div',className:'rs_result_row',template:_.template($('#wp_psearch_result_itemTpl').html().replace('/*<![CDATA[*/','').replace('/*]]>*/','')),initialize:function(){this.listenTo(this.model,'destroy',this.remove)},render:function(){if(''!==this.model.get('card')){this.setElement(this.model.get('card'))}else{this.$el.html(this.template(this.model.toJSON()))}return this}});h.views.ResultContainer=Backbone.View.extend({cached:{},addCache:function(a,b,c,d){this.cached[a+'-'+b+'-'+c]=d},flushCached:function(){this.cached={}},events:{'click .ps_navigation':'initRouter'},initRouter:function(a){a.preventDefault();var b=$(a.target);var c=b.data('href');Backbone.history.navigate(c,{trigger:true})},footerTpl:_.template($('#wp_psearch_result_footerTpl').html().replace('/*<![CDATA[*/','').replace('/*]]>*/','')),initialize:function(){this.total_items=0;this.search_in=wpps_results_vars.search_in;this.ps_lang=wpps_results_vars.ps_lang;this.next_page_number=1;this.is_first_load=true;this.listenTo(this.collection,'add',this.addItem);this.items_container=this.$('#ps_items_container');this.footer=this.$('#ps_footer_container')this.ps_more_check=this.$('#ps_more_check');this.ps_more_result_popup=this.$('#ps_more_result_popup');this.ps_no_more_result_popup=this.$('#ps_no_more_result_popup');this.ps_fetching_result_popup=this.$('#ps_fetching_result_popup');this.ps_no_result_popup=this.$('#ps_no_result_popup');this.perPage=this.$('#ps_items_container').data('perpage');this.endless_loading=false;$(window).on('scroll',function(){if(this.next_page_number>1){this.endlessScrollLoad()}}.bind(this))},render:function(){this.footer.html(this.footerTpl({next_page_number:this.next_page_number,first_load:this.is_first_load,total_items:this.total_items}));return this},addItem:function(a){var b=new h.views.Item({model:a});this.items_container.append(b.render().el);if(''==a.get('card')&&'plugin'==wpps_results_vars.template_type&&'list'==wpps_results_vars.display_type){this.items_container.append('<div style="clear:both"></div>')}},clearAll:function(){_.invoke(this.collection.where({status:true}),'destroy');this.items_container=this.$('#ps_items_container');this.items_container.html('');return false},prepareContainer:function(){if('block'==wpps_results_vars.content_type){return}if('theme'==wpps_results_vars.template_type){if($.inArray(this.search_in,wpps_results_vars.taxonomies_support)!==-1){this.items_container.addClass('ps_grid_container')}else{this.items_container.removeClass('ps_grid_container')}}if('theme'==wpps_results_vars.template_type&&!$.isEmptyObject(wpps_results_vars.child_container)){if(this.search_in in wpps_results_vars.child_container){var a=$(wpps_results_vars.child_container[this.search_in]);if(!validatePSThemeContainer(a,'ps_theme_items_container')){addClassToEndChildren(a,'ps_theme_items_container')}this.items_container.html('').append(a);this.items_container=this.$('.ps_theme_items_container')}}},routeSearchIn:function(){this.total_items=0;this.next_page_number=1;this.is_first_load=true;this.endless_loading=false;this.clearAll();this.prepareContainer();this.getItems()},getItems:function(){if(this.cached[this.search_in+'-'+this.ps_lang+'-'+this.next_page_number]){item_list=this.cached[this.search_in+'-'+this.ps_lang+'-'+this.next_page_number];this.addItems(item_list)}else{if(this.is_first_load){this.ps_fetching_result_popup.fadeIn('fast')}else{this.ps_more_result_popup.fadeIn('fast')}$.get(f,{search_in:this.search_in,ps_lang:this.ps_lang,psp:this.next_page_number,perpage:this.perPage},function(a){this.addCache(this.search_in,this.ps_lang,this.next_page_number,a);this.addItems(a);if(this.is_first_load){this.ps_fetching_result_popup.fadeOut('normal')}else{this.ps_more_result_popup.fadeOut('normal')}if(a['total']==0){if(this.is_first_load){this.ps_no_result_popup.fadeIn('normal').fadeOut(1000)}else{this.ps_no_more_result_popup.fadeIn('normal').fadeOut(1000)}}}.bind(this))}},addItems:function(c){this.$('.ps_heading_search_in_name').html(c['search_in_name']);if(c['total']>0){this.total_items+=c['items'].length;$.each(c['items'],function(a,b){if(typeof b['card']!=='undefined'){b['card']=b['card'].replace(/<\!--.*?-->/g,"")}this.collection.add(b)}.bind(this));if(c['total']>c['items'].length){this.next_page_number++;this.render();this.endless_loading=false}else{this.next_page_number=0;this.render()}this.compatibilityScript()}else{this.next_page_number=0;this.render()}},endlessScrollLoad:function(){if(this.endless_loading==false){var a=$('#ps_more_check').offset().top+$('#ps_more_check').height()>=$(window).scrollTop();var b=$('#ps_more_check').offset().top<=$(window).scrollTop()+$(window).height();if(a&&b){this.endless_loading=true;this.is_first_load=false;this.getItems()}}},compatibilityScript:function(){this.items_container.find('.animateMe').each(function(){var a=$(this),osAnimationClass=a.data("animation");a.addClass("animated").addClass(osAnimationClass)});if(typeof this.items_container.masonry==='function'||this.items_container.find('.masonry').length>0){if(this.items_container.find('.masonry').length<1){setTimeout(function(){this.items_container.masonry();this.items_container.masonry('reload')},500)}else{setTimeout(function(){this.items_container.find('.masonry').masonry();this.items_container.find('.masonry').masonry('reload')},500)}}$(document).trigger('ps-result-items-added')}});h.apps.App=Backbone.Router.extend({routes:{"?:query_parameters":"getResults_QueryString","keyword/:s_k/search-in/:s_in":"getResults","keyword/:s_k/search-in/:s_in/cat-in/:c_in":"getResults","keyword/:s_k/search-in/:s_in/search-other/:s_other":"getResults","keyword/:s_k/search-in/:s_in/in-taxonomy/:in_t":"getResults","keyword/:s_k/search-in/:s_in/cat-in/:c_in/in-taxonomy/:int_t":"getResults","keyword/:s_k/search-in/:s_in/in-taxonomy/:int_t/cat-in/:c_in":"getResults","keyword/:s_k/search-in/:s_in/cat-in/:c_in/search-other/:s_other":"getResults","keyword/:s_k/search-in/:s_in/search-other/:s_other/cat-in/:c_in":"getResults","keyword/:s_k/search-in/:s_in/search-other/:s_other/in-taxonomy/:int_t":"getResults","keyword/:s_k/search-in/:s_in/in-taxonomy/:int_t/search-other/:s_other":"getResults","keyword/:s_k/search-in/:s_in/cat-in/:c_in/in-taxonomy/:int_t/search-other/:s_other":"getResults","keyword/:s_k/search-in/:s_in/cat-in/:c_in/search-other/:s_other/in-taxonomy/:int_t":"getResults","keyword/:s_k/search-in/:s_in/search-other/:s_other/cat-in/:c_in/in-taxonomy/:int_t":"getResults","keyword/:s_k/search-in/:s_in/search-other/:s_other/in-taxonomy/:int_t/cat-in/:c_in":"getResults","keyword/:s_k/search-in/:s_in/in-taxonomy/:int_t/cat-in/:c_in/search-other/:s_other":"getResults","keyword/:s_k/search-in/:s_in/in-taxonomy/:int_t/search-other/:s_other/cat-in/:c_in":"getResults"},initialize:function(){this.collection=new h.collections.Items;this.resultCointainerView=new h.views.ResultContainer({collection:this.collection,el:$('#ps_results_container')});if(Backbone.history){Backbone.history.start({pushState:true,root:wpps_results_vars.search_page_path})}Backbone.history.navigate(wpps_results_vars.default_navigate,{trigger:true})},getResults:function(a,b){this.resultCointainerView.search_in=b;this.resultCointainerView.$('.ps_navigation').parent('.rs_result_other_item').removeClass('rs_result_other_item_activated');this.resultCointainerView.$('.ps_navigation'+b).parent('.rs_result_other_item').addClass('rs_result_other_item_activated');this.resultCointainerView.routeSearchIn()},getResults_QueryString:function(a){if(g==''){var b=this.parseQueryString(a);this.resultCointainerView.search_in=b.search_in;this.resultCointainerView.$('.ps_navigation').parent('.rs_result_other_item').removeClass('rs_result_other_item_activated');this.resultCointainerView.$('.ps_navigation'+b.search_in).parent('.rs_result_other_item').addClass('rs_result_other_item_activated');this.resultCointainerView.routeSearchIn()}},parseQueryString:function(d){var e={};if(d){_.each(_.map(decodeURI(d).split(/&/g),function(a,i){var b=a.split('='),o={};if(b.length>=1){var c=undefined;if(b.length==2)c=b[1];o[b[0]]=c}return o}),function(o){_.extend(e,o)})}return e}});wpps_app.addInitializer(function(){var a=new h.apps.App})})})(jQuery);